import{o as I,a as K,b as a,c as i,d as e,f as W,t as x,m as L,g as C,s as m,k as G,C as J,j as A,i as s,u as O,x as Q}from"./index-yptzv2Gs.js";import{u as X}from"./torrent-CsGtGM9L.js";const Y={class:"h-full flex flex-col bg-black"},Z={class:"flex items-center justify-between"},ee={class:"text-white font-medium"},te=["src"],oe={key:0,class:"absolute inset-0 flex items-center justify-center"},le={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/40"},se={class:"mb-4"},ne=["value","max"],re={class:"flex justify-between text-xs text-dark-400 mt-1"},ae={class:"flex items-center justify-between"},ie={class:"flex items-center gap-4"},ue={key:0,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},de={key:1,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},ce={class:"flex items-center gap-2"},ve={key:0,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},me={key:1,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fe={class:"flex items-center gap-4"},pe={key:0,class:"absolute inset-0 flex items-center justify-center bg-dark-900"},ke={class:"text-center"},he={class:"text-dark-400 mb-4"},ge={__name:"PlayerView",setup(we){const j=Q(),E=O(),U=X(),o=s(null),u=s(!1),d=s(!0),c=s(!1),n=s(1),f=s(0),p=s(0),k=s(!0),h=s(null),b=s("");let v=null;const $=A(()=>j.query.title||"Видео"),z=A(()=>j.query.hash||""),R=async()=>{if(z.value)try{b.value=await U.getStreamURL(z.value,0),console.log("Stream URL loaded:",b.value)}catch(l){console.error("Failed to get stream URL:",l),h.value="Не удалось получить ссылку на поток"}},B=l=>{const t=Math.floor(l/3600),r=Math.floor(l%3600/60),_=Math.floor(l%60);return t>0?`${t}:${String(r).padStart(2,"0")}:${String(_).padStart(2,"0")}`:`${r}:${String(_).padStart(2,"0")}`},g=()=>{o.value&&(u.value?o.value.pause():o.value.play(),u.value=!u.value)},F=l=>{o.value&&(o.value.currentTime=parseFloat(l.target.value))},w=l=>{o.value&&(o.value.currentTime=Math.max(0,Math.min(p.value,f.value+l)))},y=()=>{o.value&&(o.value.volume=n.value,c.value=n.value===0)},T=()=>{o.value&&(c.value=!c.value,o.value.muted=c.value)},S=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},D=()=>{o.value&&(f.value=o.value.currentTime)},P=()=>{o.value&&(p.value=o.value.duration,d.value=!1)},q=()=>{u.value=!1},N=l=>{console.error("Video error:",l),h.value="Не удалось воспроизвести видео. Проверьте, запущен ли TorrServer."},H=()=>{k.value=!0,v&&clearTimeout(v),v=setTimeout(()=>{u.value&&(k.value=!1)},3e3)},M=()=>{E.back()},V=l=>{switch(l.key){case" ":case"k":l.preventDefault(),g();break;case"ArrowLeft":w(-10);break;case"ArrowRight":w(10);break;case"ArrowUp":n.value=Math.min(1,n.value+.1),y();break;case"ArrowDown":n.value=Math.max(0,n.value-.1),y();break;case"m":T();break;case"f":S();break;case"Escape":M();break}};return I(async()=>{document.addEventListener("keydown",V),await R()}),K(()=>{document.removeEventListener("keydown",V),v&&clearTimeout(v)}),(l,t)=>(a(),i("div",Y,[e("div",{class:L(["absolute top-0 left-0 right-0 z-10 p-4 bg-gradient-to-b from-black/80 to-transparent transition-opacity duration-300",{"opacity-0":!k.value}])},[e("div",Z,[e("button",{onClick:M,class:"flex items-center gap-2 text-white hover:text-accent-400 transition-colors"},[...t[5]||(t[5]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),W(" Назад ",-1)])]),e("h2",ee,x($.value),1),t[6]||(t[6]=e("div",{class:"w-20"},null,-1))])],2),e("div",{class:"flex-1 flex items-center justify-center relative",onMousemove:H,onClick:g},[e("video",{ref_key:"videoRef",ref:o,class:"max-w-full max-h-full",src:b.value,onTimeupdate:D,onLoadedmetadata:P,onEnded:q,onWaiting:t[0]||(t[0]=r=>d.value=!0),onPlaying:t[1]||(t[1]=r=>d.value=!1),onError:N},null,40,te),d.value?(a(),i("div",oe,[...t[7]||(t[7]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-16 h-16 border-4 border-accent-500 border-t-transparent rounded-full animate-spin"}),e("p",{class:"text-white"},"Буферизация...")],-1)])])):C("",!0),!u.value&&!d.value?(a(),i("div",le,[...t[8]||(t[8]=[e("button",{class:"p-6 bg-accent-600/80 rounded-full hover:bg-accent-600 transition-colors"},[e("svg",{class:"w-12 h-12 text-white",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)])])):C("",!0)],32),e("div",{class:L(["absolute bottom-0 left-0 right-0 z-10 p-4 bg-gradient-to-t from-black/80 to-transparent transition-opacity duration-300",{"opacity-0":!k.value}])},[e("div",se,[e("input",{type:"range",value:f.value,max:p.value,onInput:F,class:"w-full h-1 bg-dark-600 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-accent-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"},null,40,ne),e("div",re,[e("span",null,x(B(f.value)),1),e("span",null,x(B(p.value)),1)])]),e("div",ae,[e("div",ie,[e("button",{onClick:m(g,["stop"]),class:"text-white hover:text-accent-400 transition-colors"},[u.value?(a(),i("svg",ue,[...t[9]||(t[9]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])):(a(),i("svg",de,[...t[10]||(t[10]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])]))]),e("button",{onClick:t[2]||(t[2]=m(r=>w(-10),["stop"])),class:"text-white hover:text-accent-400 transition-colors"},[...t[11]||(t[11]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0019 16V8a1 1 0 00-1.6-.8l-5.333 4zM4.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0011 16V8a1 1 0 00-1.6-.8l-5.334 4z"})],-1)])]),e("button",{onClick:t[3]||(t[3]=m(r=>w(10),["stop"])),class:"text-white hover:text-accent-400 transition-colors"},[...t[12]||(t[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z"})],-1)])]),e("div",ce,[e("button",{onClick:m(T,["stop"]),class:"text-white hover:text-accent-400 transition-colors"},[c.value||n.value===0?(a(),i("svg",ve,[...t[13]||(t[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(a(),i("svg",me,[...t[14]||(t[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))]),G(e("input",{type:"range","onUpdate:modelValue":t[4]||(t[4]=r=>n.value=r),min:"0",max:"1",step:"0.1",onInput:y,class:"w-20 h-1 bg-dark-600 rounded-full appearance-none cursor-pointer"},null,544),[[J,n.value]])])]),e("div",fe,[e("button",{onClick:m(S,["stop"]),class:"text-white hover:text-accent-400 transition-colors"},[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})],-1)])])])])],2),h.value?(a(),i("div",pe,[e("div",ke,[t[16]||(t[16]=e("svg",{class:"w-16 h-16 text-red-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[17]||(t[17]=e("h3",{class:"text-xl font-semibold text-white mb-2"},"Ошибка воспроизведения",-1)),e("p",he,x(h.value),1),e("button",{onClick:M,class:"btn-primary"},"Назад")])])):C("",!0)]))}};export{ge as default};
