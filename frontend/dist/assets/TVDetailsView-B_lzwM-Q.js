import{o as ee,p as te,b as a,c as l,e as b,d as e,l as S,f as h,t as i,g as c,F as y,r as M,s as H,w as se,i as n,x as oe,u as ae,y as q,h as le}from"./index-yptzv2Gs.js";import{u as re,_ as E}from"./LoadingSpinner-BgCI5orC.js";import{u as ie}from"./torrent-CsGtGM9L.js";import{_ as ne,a as de}from"./TorrentCard-B9zUgLU8.js";import{M as ce}from"./MediaRow-D2uU2rYO.js";import"./MediaCard-BGe4CHWK.js";const ue={key:0,class:"h-full"},ve={key:1,class:"min-h-full"},me={class:"relative h-96"},pe=["src","alt"],he={class:"relative -mt-32 px-6 pb-6"},fe={class:"flex gap-6"},ge={class:"flex-shrink-0"},ke=["src","alt"],_e={class:"flex-1 pt-8"},xe={class:"text-3xl font-bold text-white mb-2"},we={class:"flex flex-wrap items-center gap-3 text-sm text-dark-400 mb-4"},be={key:0},ye={class:"flex items-center gap-1 text-yellow-400"},Me={class:"text-white font-medium"},Ce={class:"flex flex-wrap gap-2 mb-4"},Te={class:"flex gap-3 mb-6"},je=["fill"],$e=["fill"],Be={key:0,class:"text-accent-400 italic mb-4"},Se={class:"mb-6"},Ve={class:"text-dark-300 leading-relaxed"},ze={key:0,class:"mt-8"},Le={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Fe=["onClick"],De=["src","alt"],Ue={class:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 to-transparent"},Re={class:"text-white text-sm font-medium line-clamp-1"},Ie={class:"text-dark-400 text-xs"},Ee={class:"mt-8"},Ne={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},Ae=["onClick"],Ge={class:"relative aspect-[2/3] rounded-xl overflow-hidden bg-dark-800"},He=["src","alt"],qe={key:1,class:"w-full h-full flex items-center justify-center bg-dark-800"},Je={class:"absolute top-2 right-2 px-2 py-1 bg-dark-900/80 backdrop-blur-sm rounded-md text-xs font-medium text-white"},Pe={class:"mt-2"},Qe={class:"text-white font-medium text-sm line-clamp-1"},Ye={key:0,class:"text-dark-500 text-xs"},Oe={key:1,class:"mt-8"},Ke={class:"bg-dark-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col"},We={class:"flex items-center gap-3 px-4 py-3 border-b border-dark-800"},Xe={class:"text-base font-semibold text-white flex-1 text-center"},Ze={class:"text-dark-500 text-sm w-[76px] text-right"},et={class:"flex-1 overflow-y-auto p-4"},tt={key:0,class:"py-8"},st={key:1,class:"space-y-3"},ot=["onClick"],at={class:"relative flex-shrink-0"},lt=["src","alt"],rt={key:1,class:"w-40 h-24 bg-dark-700 rounded-lg flex items-center justify-center"},it={class:"flex-1 min-w-0"},nt={class:"flex items-start justify-between gap-3"},dt={class:"flex-1 min-w-0"},ct={class:"font-medium text-white"},ut={class:"text-accent-500"},vt={class:"text-dark-400 text-sm mt-1 line-clamp-2"},mt={class:"flex items-center gap-3 mt-2 text-xs text-dark-500"},pt={key:0},ht={key:1},ft={key:2,class:"flex items-center gap-1 text-yellow-400"},gt={key:2,class:"py-8 text-center text-dark-400"},kt={key:0,class:"py-8"},_t={key:1,class:"py-8 text-center text-dark-400"},xt={key:2,class:"space-y-3 max-h-96 overflow-y-auto"},wt=["href"],bt={class:"w-full max-w-5xl aspect-video"},yt=["src"],Vt={__name:"TVDetailsView",setup(Mt){const V=oe(),J=ae(),d=re(),z=ie(),o=n(null),L=n(!0),g=n(!1),k=n(!1),F=n(1),N=n(null),C=n([]),D=n(!1),T=n(!1),j=n(!1),_=n(!1),$=n([]),v=n(null),U=n([]),B=n(!1),x=n(null),R=n([]),P=r=>r?new Date(r).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}):"",Q=async r=>{N.value=r,F.value=r.season_number,j.value=!0,D.value=!0;try{const t=await d.getSeasonDetails(o.value.id,r.season_number);C.value=(t==null?void 0:t.episodes)||[]}catch(t){console.error("Failed to load episodes:",t)}finally{D.value=!1}},Y=r=>{x.value=r,B.value=!0},O=async()=>{var r;g.value?await d.removeFromFavorites(o.value.id,"tv"):await d.addToFavorites({tmdb_id:o.value.id,media_type:"tv",title:o.value.name,poster:o.value.poster_path,year:((r=o.value.first_air_date)==null?void 0:r.split("-")[0])||"",rating:o.value.vote_average||0}),g.value=!g.value},K=async()=>{var r;k.value?await d.removeFromBookmarks(o.value.id,"tv"):await d.addToBookmarks({tmdb_id:o.value.id,media_type:"tv",title:o.value.name,poster:o.value.poster_path,year:((r=o.value.first_air_date)==null?void 0:r.split("-")[0])||""}),k.value=!k.value},W=async()=>{var r;T.value=!0,_.value=!0;try{const t=`${o.value.name} ${((r=o.value.first_air_date)==null?void 0:r.split("-")[0])||""}`;$.value=await z.searchJackett(t,"tv")}catch(t){console.error("Failed to search torrents:",t)}finally{_.value=!1}},X=async r=>{v.value=r,T.value=!0,_.value=!0;try{const t=`${o.value.name} S${String(F.value).padStart(2,"0")}E${String(r.episode_number).padStart(2,"0")}`;$.value=await z.searchJackett(t,"tv")}catch(t){console.error("Failed to search torrents:",t)}finally{_.value=!1}},Z=async r=>{try{const t=r.MagnetUri||r.Link;if(!t){console.error("No MagnetUri or Link found in torrent object!"),alert("Невозможно получить ссылку для этого торрента");return}const f=v.value?`${o.value.name} - ${v.value.name}`:o.value.name,m=await z.addTorrent(t,f,d.getImageURL(o.value.poster_path));if(console.log("Torrent added:",m),m){const s={tmdb_id:o.value.id,media_type:"tv",title:o.value.name,poster:o.value.poster_path,progress:0,duration:2700};v.value&&(s.episode=`S${F.value}E${v.value.episode_number} - ${v.value.name}`,s.duration=(v.value.runtime||45)*60),await d.addToHistory(s);const p=v.value?`${o.value.name} - ${v.value.name}`:o.value.name;J.push({name:"Player",query:{hash:m.hash,title:p}})}}catch(t){console.error("Failed to play torrent:",t)}},A=async()=>{var f,m,s,p,I,G;L.value=!0;const r=parseInt(V.params.id),t=new Date().toISOString().split("T")[0];try{if(o.value=await d.getTVDetails(r),g.value=await d.isFavorite(r,"tv"),(s=(m=(f=window.go)==null?void 0:f.main)==null?void 0:m.TMDB)!=null&&s.GetTVVideos){const u=await window.go.main.TMDB.GetTVVideos(r);u!=null&&u.results&&(U.value=u.results.filter(w=>w.site==="YouTube"&&["Trailer","Teaser","Clip"].includes(w.type)).slice(0,6))}if((G=(I=(p=window.go)==null?void 0:p.main)==null?void 0:I.TMDB)!=null&&G.GetTVSimilar){const u=await window.go.main.TMDB.GetTVSimilar(r);u!=null&&u.results&&(R.value=u.results.filter(w=>w.first_air_date&&w.first_air_date<=t).slice(0,20))}}catch(u){console.error("Failed to load TV details:",u)}finally{L.value=!1}};return ee(A),te(()=>V.params.id,()=>{V.name==="TVDetails"&&A()}),(r,t)=>{var f,m;return L.value?(a(),l("div",ue,[b(E,{text:"Загрузка информации о сериале..."})])):o.value?(a(),l("div",ve,[e("div",me,[e("img",{src:S(d).getImageURL(o.value.backdrop_path,"w1280"),alt:o.value.name,class:"absolute inset-0 w-full h-full object-cover",draggable:"false"},null,8,pe),t[7]||(t[7]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-dark-900 via-dark-900/60 to-dark-900/30"},null,-1)),e("button",{onClick:t[0]||(t[0]=s=>r.$router.back()),class:"absolute top-6 left-6 flex items-center gap-2 px-4 py-2 bg-dark-800/80 backdrop-blur-sm rounded-lg hover:bg-dark-700 transition-colors text-white text-sm font-medium"},[...t[6]||(t[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),h(" Назад ",-1)])])]),e("div",he,[e("div",fe,[e("div",ge,[e("img",{src:S(d).getImageURL(o.value.poster_path,"w342"),alt:o.value.name,class:"w-48 h-72 object-cover rounded-xl shadow-2xl",draggable:"false"},null,8,ke)]),e("div",_e,[e("h1",xe,i(o.value.name),1),e("div",we,[o.value.first_air_date?(a(),l("span",be,i(o.value.first_air_date.split("-")[0]),1)):c("",!0),e("span",null,i(o.value.number_of_seasons)+" сезон(ов)",1),e("span",null,i(o.value.number_of_episodes)+" эпизод(ов)",1),e("div",ye,[t[8]||(t[8]=e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)),e("span",Me,i((f=o.value.vote_average)==null?void 0:f.toFixed(1)),1)])]),e("div",Ce,[(a(!0),l(y,null,M(o.value.genres,s=>(a(),l("span",{key:s.id,class:"genre-tag"},i(s.name),1))),128))]),e("div",Te,[e("button",{onClick:W,class:"btn-primary flex items-center gap-2"},[...t[9]||(t[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),h(" Смотреть ",-1)])]),e("button",{onClick:O,class:"btn-secondary flex items-center gap-2"},[(a(),l("svg",{class:"w-5 h-5",fill:g.value?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[10]||(t[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1)])],8,je)),h(" "+i(g.value?"В избранном":"В избранное"),1)]),e("button",{onClick:K,class:"btn-secondary flex items-center gap-2"},[(a(),l("svg",{class:"w-5 h-5",fill:k.value?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[11]||(t[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"},null,-1)])],8,$e)),h(" "+i(k.value?"В закладках":"В закладки"),1)])]),o.value.tagline?(a(),l("p",Be,i(o.value.tagline),1)):c("",!0),e("div",Se,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-white mb-2"},"Описание",-1)),e("p",Ve,i(o.value.overview||"Описание отсутствует"),1)])])]),U.value.length>0?(a(),l("div",ze,[t[14]||(t[14]=e("h3",{class:"text-xl font-semibold text-white mb-4"},"Трейлеры и видео",-1)),e("div",Le,[(a(!0),l(y,null,M(U.value,s=>(a(),l("div",{key:s.id,class:"relative rounded-xl overflow-hidden bg-dark-800 cursor-pointer group",onClick:p=>Y(s)},[e("img",{src:`https://img.youtube.com/vi/${s.key}/mqdefault.jpg`,alt:s.name,class:"w-full aspect-video object-cover",draggable:"false"},null,8,De),t[13]||(t[13]=q('<div class="absolute inset-0 bg-black/40 flex items-center justify-center group-hover:bg-black/20 transition-colors"><div class="w-14 h-14 bg-accent-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform"><svg class="w-6 h-6 text-white ml-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div>',1)),e("div",Ue,[e("p",Re,i(s.name),1),e("p",Ie,i(s.type),1)])],8,Fe))),128))])])):c("",!0),e("div",Ee,[t[17]||(t[17]=e("h3",{class:"text-xl font-semibold text-white mb-4"},"Сезоны",-1)),e("div",Ne,[(a(!0),l(y,null,M(o.value.seasons.filter(s=>s.season_number>0),s=>{var p;return a(),l("div",{key:s.id,class:"group cursor-pointer",onClick:I=>Q(s)},[e("div",Ge,[s.poster_path?(a(),l("img",{key:0,src:S(d).getImageURL(s.poster_path,"w342"),alt:s.name,class:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",draggable:"false"},null,8,He)):(a(),l("div",qe,[...t[15]||(t[15]=[e("svg",{class:"w-12 h-12 text-dark-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})],-1)])])),t[16]||(t[16]=e("div",{class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},[e("div",{class:"w-12 h-12 bg-accent-600 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})])])],-1)),e("div",Je,i(s.episode_count)+" эп. ",1)]),e("div",Pe,[e("h4",Qe,i(s.name),1),s.air_date?(a(),l("p",Ye,i((p=s.air_date)==null?void 0:p.split("-")[0]),1)):c("",!0)])],8,Ae)}),128))])]),R.value.length>0?(a(),l("div",Oe,[b(ce,{title:"Похожие сериалы",items:R.value,type:"tv"},null,8,["items"])])):c("",!0)]),j.value?(a(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:t[2]||(t[2]=H(s=>j.value=!1,["self"]))},[e("div",Ke,[e("div",We,[e("button",{onClick:t[1]||(t[1]=s=>j.value=!1),class:"flex items-center gap-1.5 px-3 py-1.5 hover:bg-dark-800 rounded-lg transition-colors text-dark-400 hover:text-white text-sm"},[...t[18]||(t[18]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),h(" Назад ",-1)])]),e("h2",Xe,i((m=N.value)==null?void 0:m.name),1),e("span",Ze,i(C.value.length)+" эп.",1)]),e("div",et,[D.value?(a(),l("div",tt,[b(E,{text:"Загрузка эпизодов..."})])):C.value.length>0?(a(),l("div",st,[(a(!0),l(y,null,M(C.value,s=>(a(),l("div",{key:s.id,class:"bg-dark-800 rounded-xl p-4 flex gap-4 hover:bg-dark-700/80 transition-colors cursor-pointer",onClick:p=>X(s)},[e("div",at,[s.still_path?(a(),l("img",{key:0,src:S(d).getImageURL(s.still_path,"w300"),alt:s.name,class:"w-40 h-24 object-cover rounded-lg",draggable:"false"},null,8,lt)):(a(),l("div",rt,[...t[19]||(t[19]=[e("svg",{class:"w-8 h-8 text-dark-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])),t[20]||(t[20]=q('<div class="absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity"><div class="w-10 h-10 bg-accent-600 rounded-full flex items-center justify-center"><svg class="w-4 h-4 text-white ml-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div>',1))]),e("div",it,[e("div",nt,[e("div",dt,[e("h4",ct,[e("span",ut,"E"+i(s.episode_number),1),h(" · "+i(s.name),1)]),e("p",vt,i(s.overview||"Описание отсутствует"),1),e("div",mt,[s.air_date?(a(),l("span",pt,i(P(s.air_date)),1)):c("",!0),s.runtime?(a(),l("span",ht,i(s.runtime)+" мин",1)):c("",!0),s.vote_average?(a(),l("span",ft,[t[21]||(t[21]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)),h(" "+i(s.vote_average.toFixed(1)),1)])):c("",!0)])])])])],8,ot))),128))])):(a(),l("div",gt," Эпизоды не найдены "))])])])):c("",!0),b(ne,{visible:T.value,title:"Выберите торрент",onClose:t[3]||(t[3]=s=>T.value=!1)},{default:se(()=>[_.value?(a(),l("div",kt,[b(E,{text:"Поиск торрентов..."})])):$.value.length===0?(a(),l("div",_t," Торренты не найдены. ")):(a(),l("div",xt,[(a(!0),l(y,null,M($.value,s=>(a(),le(de,{key:s.Guid,torrent:s,onPlay:Z},null,8,["torrent"]))),128))]))]),_:1},8,["visible"]),B.value?(a(),l("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:t[5]||(t[5]=H(s=>B.value=!1,["self"]))},[e("button",{onClick:t[4]||(t[4]=s=>B.value=!1),class:"absolute top-4 right-4 p-2 bg-dark-800/80 rounded-full hover:bg-dark-700 transition-colors z-10"},[...t[22]||(t[22]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),x.value?(a(),l("a",{key:0,href:`https://www.youtube.com/watch?v=${x.value.key}`,target:"_blank",class:"absolute top-4 left-4 flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm transition-colors z-10"},[...t[23]||(t[23]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})],-1),h(" Открыть на YouTube ",-1)])],8,wt)):c("",!0),e("div",bt,[x.value?(a(),l("iframe",{key:0,src:`https://www.youtube-nocookie.com/embed/${x.value.key}?autoplay=1&rel=0&modestbranding=1&origin=${encodeURIComponent(r.window.location.origin)}`,class:"w-full h-full rounded-xl",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,yt)):c("",!0)])])):c("",!0)])):c("",!0)}}};export{Vt as default};
