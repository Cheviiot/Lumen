import{o as Q,p as K,b as l,c as a,e as h,d as t,l as N,f as k,t as u,g as v,F as j,r as F,s as W,w as X,i as n,x as Z,u as ee,y as te,h as oe}from"./index-yptzv2Gs.js";import{u as se,_ as R}from"./LoadingSpinner-BgCI5orC.js";import{u as le}from"./torrent-CsGtGM9L.js";import{_ as ae,a as re}from"./TorrentCard-B9zUgLU8.js";import{M as A}from"./MediaRow-D2uU2rYO.js";import"./MediaCard-BGe4CHWK.js";const ie={key:0,class:"h-full"},ne={key:1,class:"min-h-full"},de={class:"relative h-96"},ue=["src","alt"],ce={class:"relative -mt-32 px-6 pb-6"},ve={class:"flex gap-6"},me={class:"flex-shrink-0"},pe=["src","alt"],fe={class:"flex-1 pt-8"},ge={class:"text-3xl font-bold text-white mb-2"},he={class:"flex flex-wrap items-center gap-3 text-sm text-dark-400 mb-4"},ke={key:0},we={key:1},_e={class:"flex items-center gap-1 text-yellow-400"},be={class:"text-white font-medium"},xe={class:"flex flex-wrap gap-2 mb-4"},ye={class:"flex gap-3 mb-6"},Me=["fill"],Ce=["fill"],Te={key:0,class:"text-accent-400 italic mb-4"},Be={class:"mb-6"},$e={class:"text-dark-300 leading-relaxed"},je={key:0,class:"mt-8"},Fe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ze=["onClick"],De=["src","alt"],Le={class:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 to-transparent"},Se={class:"text-white text-sm font-medium line-clamp-1"},Ve={class:"text-dark-400 text-xs"},Ge={key:1,class:"mt-8"},Ue={key:2,class:"mt-8"},Ie=["href"],Ne={class:"w-full max-w-5xl aspect-video"},Re=["src"],Ae={key:0,class:"py-8"},qe={key:1,class:"py-8 text-center text-dark-400"},Je={key:2,class:"space-y-3 max-h-96 overflow-y-auto"},We={__name:"MovieDetailsView",setup(Pe){const _=Z(),q=ee(),c=se(),z=le(),o=n(null),b=n(!0),p=n(!1),f=n(!1),x=n(!1),y=n(!1),M=n([]),C=n([]),w=n(!1),g=n(null),T=n([]),B=n([]),J=s=>{const e=Math.floor(s/60),d=s%60;return`${e}ч ${d}мин`},P=async()=>{var s;p.value?await c.removeFromFavorites(o.value.id,"movie"):await c.addToFavorites({tmdb_id:o.value.id,media_type:"movie",title:o.value.title,poster:o.value.poster_path,year:((s=o.value.release_date)==null?void 0:s.split("-")[0])||"",rating:o.value.vote_average||0}),p.value=!p.value},Y=async()=>{var s;f.value?await c.removeFromBookmarks(o.value.id,"movie"):await c.addToBookmarks({tmdb_id:o.value.id,media_type:"movie",title:o.value.title,poster:o.value.poster_path,year:((s=o.value.release_date)==null?void 0:s.split("-")[0])||""}),f.value=!f.value},E=async()=>{var s;x.value=!0,y.value=!0;try{const e=`${o.value.title} ${((s=o.value.release_date)==null?void 0:s.split("-")[0])||""}`;M.value=await z.searchJackett(e,"movie")}catch(e){console.error("Failed to search torrents:",e)}finally{y.value=!1}},H=async s=>{try{const e=s.MagnetUri||s.Link;if(!e){console.error("No MagnetUri or Link found in torrent object!"),alert("Невозможно получить ссылку для этого торрента");return}const d=await z.addTorrent(e,o.value.title,c.getImageURL(o.value.poster_path));console.log("Torrent added:",d),d&&(await c.addToHistory({tmdb_id:o.value.id,media_type:"movie",title:o.value.title,poster:o.value.poster_path,progress:0,duration:o.value.runtime*60}),q.push({name:"Player",query:{hash:d.hash,title:o.value.title}}))}catch(e){console.error("Failed to play torrent:",e)}},D=async()=>{var d,r,$,L,S,V,G,U,I;b.value=!0;const s=parseInt(_.params.id),e=new Date().toISOString().split("T")[0];try{if(o.value=await c.getMovieDetails(s),p.value=await c.isFavorite(s,"movie"),($=(r=(d=window.go)==null?void 0:d.main)==null?void 0:r.TMDB)!=null&&$.GetMovieVideos){const i=await window.go.main.TMDB.GetMovieVideos(s);i!=null&&i.results&&(C.value=i.results.filter(m=>m.site==="YouTube"&&["Trailer","Teaser","Clip"].includes(m.type)).slice(0,6))}if((V=(S=(L=window.go)==null?void 0:L.main)==null?void 0:S.TMDB)!=null&&V.GetMovieSimilar){const i=await window.go.main.TMDB.GetMovieSimilar(s);i!=null&&i.results&&(B.value=i.results.filter(m=>m.release_date&&m.release_date<=e).slice(0,20))}if(o.value.belongs_to_collection&&((I=(U=(G=window.go)==null?void 0:G.main)==null?void 0:U.TMDB)!=null&&I.GetCollection)){const i=await window.go.main.TMDB.GetCollection(o.value.belongs_to_collection.id);i!=null&&i.parts&&(T.value=i.parts.filter(m=>m.id!==s&&m.release_date&&m.release_date<=e).slice(0,20))}}catch(i){console.error("Failed to load movie details:",i)}finally{b.value=!1}};Q(D),K(()=>_.params.id,()=>{_.name==="MovieDetails"&&D()});const O=s=>{g.value=s,w.value=!0};return(s,e)=>{var d;return b.value?(l(),a("div",ie,[h(R,{text:"Загрузка информации о фильме..."})])):o.value?(l(),a("div",ne,[t("div",de,[t("img",{src:N(c).getImageURL(o.value.backdrop_path,"w1280"),alt:o.value.title,class:"absolute inset-0 w-full h-full object-cover",draggable:"false"},null,8,ue),e[5]||(e[5]=t("div",{class:"absolute inset-0 bg-gradient-to-t from-dark-900 via-dark-900/60 to-dark-900/30"},null,-1)),t("button",{onClick:e[0]||(e[0]=r=>s.$router.back()),class:"absolute top-6 left-6 flex items-center gap-2 px-4 py-2 bg-dark-800/80 backdrop-blur-sm rounded-lg hover:bg-dark-700 transition-colors text-white text-sm font-medium"},[...e[4]||(e[4]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),k(" Назад ",-1)])])]),t("div",ce,[t("div",ve,[t("div",me,[t("img",{src:N(c).getImageURL(o.value.poster_path,"w342"),alt:o.value.title,class:"w-48 h-72 object-cover rounded-xl shadow-2xl",draggable:"false"},null,8,pe)]),t("div",fe,[t("h1",ge,u(o.value.title),1),t("div",he,[o.value.release_date?(l(),a("span",ke,u(o.value.release_date.split("-")[0]),1)):v("",!0),o.value.runtime?(l(),a("span",we,u(J(o.value.runtime)),1)):v("",!0),t("div",_e,[e[6]||(e[6]=t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)),t("span",be,u((d=o.value.vote_average)==null?void 0:d.toFixed(1)),1)])]),t("div",xe,[(l(!0),a(j,null,F(o.value.genres,r=>(l(),a("span",{key:r.id,class:"genre-tag"},u(r.name),1))),128))]),t("div",ye,[t("button",{onClick:E,class:"btn-primary flex items-center gap-2"},[...e[7]||(e[7]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),k(" Смотреть ",-1)])]),t("button",{onClick:P,class:"btn-secondary flex items-center gap-2"},[(l(),a("svg",{class:"w-5 h-5",fill:p.value?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[8]||(e[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1)])],8,Me)),k(" "+u(p.value?"В избранном":"В избранное"),1)]),t("button",{onClick:Y,class:"btn-secondary flex items-center gap-2"},[(l(),a("svg",{class:"w-5 h-5",fill:f.value?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"},null,-1)])],8,Ce)),k(" "+u(f.value?"В закладках":"В закладки"),1)])]),o.value.tagline?(l(),a("p",Te,u(o.value.tagline),1)):v("",!0),t("div",Be,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold text-white mb-2"},"Описание",-1)),t("p",$e,u(o.value.overview||"Описание отсутствует"),1)])])]),C.value.length>0?(l(),a("div",je,[e[12]||(e[12]=t("h3",{class:"text-xl font-semibold text-white mb-4"},"Трейлеры и видео",-1)),t("div",Fe,[(l(!0),a(j,null,F(C.value,r=>(l(),a("div",{key:r.id,class:"relative rounded-xl overflow-hidden bg-dark-800 cursor-pointer group",onClick:$=>O(r)},[t("img",{src:`https://img.youtube.com/vi/${r.key}/mqdefault.jpg`,alt:r.name,class:"w-full aspect-video object-cover",draggable:"false"},null,8,De),e[11]||(e[11]=te('<div class="absolute inset-0 bg-black/40 flex items-center justify-center group-hover:bg-black/20 transition-colors"><div class="w-14 h-14 bg-accent-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform"><svg class="w-6 h-6 text-white ml-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div>',1)),t("div",Le,[t("p",Se,u(r.name),1),t("p",Ve,u(r.type),1)])],8,ze))),128))])])):v("",!0),B.value.length>0?(l(),a("div",Ge,[h(A,{title:"Похожие фильмы",items:B.value,type:"movie"},null,8,["items"])])):v("",!0),T.value.length>0?(l(),a("div",Ue,[h(A,{title:"Коллекция",items:T.value,type:"movie"},null,8,["items"])])):v("",!0)]),w.value?(l(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:e[2]||(e[2]=W(r=>w.value=!1,["self"]))},[t("button",{onClick:e[1]||(e[1]=r=>w.value=!1),class:"absolute top-4 right-4 p-2 bg-dark-800/80 rounded-full hover:bg-dark-700 transition-colors z-10"},[...e[13]||(e[13]=[t("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),g.value?(l(),a("a",{key:0,href:`https://www.youtube.com/watch?v=${g.value.key}`,target:"_blank",class:"absolute top-4 left-4 flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm transition-colors z-10"},[...e[14]||(e[14]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})],-1),k(" Открыть на YouTube ",-1)])],8,Ie)):v("",!0),t("div",Ne,[g.value?(l(),a("iframe",{key:0,src:`https://www.youtube-nocookie.com/embed/${g.value.key}?autoplay=1&rel=0&modestbranding=1&origin=${encodeURIComponent(s.window.location.origin)}`,class:"w-full h-full rounded-xl",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,Re)):v("",!0)])])):v("",!0),h(ae,{visible:x.value,title:"Выберите торрент",onClose:e[3]||(e[3]=r=>x.value=!1)},{default:X(()=>[y.value?(l(),a("div",Ae,[h(R,{text:"Поиск торрентов..."})])):M.value.length===0?(l(),a("div",qe," Торренты не найдены. Попробуйте позже или проверьте настройки Jackett. ")):(l(),a("div",Je,[(l(!0),a(j,null,F(M.value,r=>(l(),oe(re,{key:r.Guid,torrent:r,onPlay:H},null,8,["torrent"]))),128))]))]),_:1},8,["visible"])])):v("",!0)}}};export{We as default};
